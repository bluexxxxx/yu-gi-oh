import{O as T,aj as Z,z as D,b as g,d as L,r as z,f as j,v as R,g as V,h as y,K as q}from"./index.c7164d39.js";import{a as I,o as f}from"./delegate.64eb1156.js";import{c as O}from"./index.d62e03b3.js";const W=(e,...t)=>typeof e=="function"?e(...t):typeof e=="string"?T(e):typeof e=="number"?T(String(e)):null;function Y(e,t="default",n=void 0){const r=e[t];if(!r)return Z("getFirstSlotVNode",`slot[${t}] is empty`),null;const s=D(r(n));return s.length===1?s[0]:(Z("getFirstSlotVNode",`slot[${t}] should have exactly one child`),null)}const ee=g("n-modal-body"),te=g("n-modal"),ne=g("n-drawer-body"),re=g("n-popover-body"),c="@@coContext",H={mounted(e,{value:t,modifiers:n}){e[c]={handler:void 0},typeof t=="function"&&(e[c].handler=t,I("clickoutside",e,t,{capture:n.capture}))},updated(e,{value:t,modifiers:n}){const r=e[c];typeof t=="function"?r.handler?r.handler!==t&&(f("clickoutside",e,r.handler,{capture:n.capture}),r.handler=t,I("clickoutside",e,t,{capture:n.capture})):(e[c].handler=t,I("clickoutside",e,t,{capture:n.capture})):r.handler&&(f("clickoutside",e,r.handler,{capture:n.capture}),r.handler=void 0)},unmounted(e,{modifiers:t}){const{handler:n}=e[c];n&&f("clickoutside",e,n,{capture:t.capture}),e[c].handler=void 0}},ie=H;function U(e,t){console.error(`[vdirs/${e}]: ${t}`)}class _{constructor(){this.elementZIndex=new Map,this.nextZIndex=2e3}get elementCount(){return this.elementZIndex.size}ensureZIndex(t,n){const{elementZIndex:r}=this;if(n!==void 0){t.style.zIndex=`${n}`,r.delete(t);return}const{nextZIndex:s}=this;r.has(t)&&r.get(t)+1===this.nextZIndex||(t.style.zIndex=`${s}`,r.set(t,s),this.nextZIndex=s+1,this.squashState())}unregister(t,n){const{elementZIndex:r}=this;r.has(t)?r.delete(t):n===void 0&&U("z-index-manager/unregister-element","Element not found when unregistering."),this.squashState()}squashState(){const{elementCount:t}=this;t||(this.nextZIndex=2e3),this.nextZIndex-t>2500&&this.rearrange()}rearrange(){const t=Array.from(this.elementZIndex.entries());t.sort((n,r)=>n[1]-r[1]),this.nextZIndex=2e3,t.forEach(n=>{const r=n[0],s=this.nextZIndex++;`${s}`!==r.style.zIndex&&(r.style.zIndex=`${s}`)})}}const p=new _,d="@@ziContext",P={mounted(e,t){const{value:n={}}=t,{zIndex:r,enabled:s}=n;e[d]={enabled:!!s,initialized:!1},s&&(p.ensureZIndex(e,r),e[d].initialized=!0)},updated(e,t){const{value:n={}}=t,{zIndex:r,enabled:s}=n,u=e[d].enabled;s&&!u&&(p.ensureZIndex(e,r),e[d].initialized=!0),e[d].enabled=!!s},unmounted(e,t){if(!e[d].initialized)return;const{value:n={}}=t,{zIndex:r}=n;p.unregister(e,r)}},oe=P;function w(e){return typeof e=="string"?document.querySelector(e):e()}function k(e){return e instanceof HTMLElement}function $(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if(k(n)&&(A(n)||$(n)))return!0}return!1}function N(e){for(let t=e.childNodes.length-1;t>=0;t--){const n=e.childNodes[t];if(k(n)&&(A(n)||N(n)))return!0}return!1}function A(e){if(!X(e))return!1;try{e.focus({preventScroll:!0})}catch{}return document.activeElement===e}function X(e){if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.getAttribute("disabled"))return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return e.type!=="hidden"&&e.type!=="file";case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}}let l=[];const se=L({name:"FocusTrap",props:{disabled:Boolean,active:Boolean,autoFocus:{type:Boolean,default:!0},onEsc:Function,initialFocusTo:String,finalFocusTo:String,returnFocusOnDeactivated:{type:Boolean,default:!0}},setup(e){const t=O(),n=z(null),r=z(null);let s=!1,u=!1;const E=document.activeElement;function h(){return l[l.length-1]===t}function v(i){var o;i.code==="Escape"&&h()&&((o=e.onEsc)===null||o===void 0||o.call(e,i))}j(()=>{R(()=>e.active,i=>{i?(B(),I("keydown",document,v)):(f("keydown",document,v),s&&S())},{immediate:!0})}),V(()=>{f("keydown",document,v),s&&S()});function F(i){if(!u&&h()){const o=b();if(o===null||o.contains(i.target))return;a("first")}}function b(){const i=n.value;if(i===null)return null;let o=i;for(;o=o.nextSibling,!(o===null||o instanceof Element&&o.tagName==="DIV"););return o}function B(){var i;if(!e.disabled){if(l.push(t),e.autoFocus){const{initialFocusTo:o}=e;o===void 0?a("first"):(i=w(o))===null||i===void 0||i.focus({preventScroll:!0})}s=!0,document.addEventListener("focus",F,!0)}}function S(){var i;if(e.disabled||(document.removeEventListener("focus",F,!0),l=l.filter(x=>x!==t),h()))return;const{finalFocusTo:o}=e;o!==void 0?(i=w(o))===null||i===void 0||i.focus({preventScroll:!0}):e.returnFocusOnDeactivated&&E instanceof HTMLElement&&(u=!0,E.focus({preventScroll:!0}),u=!1)}function a(i){if(!!h()&&e.active){const o=n.value,x=r.value;if(o!==null&&x!==null){const m=b();if(m==null||m===x){u=!0,o.focus({preventScroll:!0}),u=!1;return}u=!0;const M=i==="first"?$(m):N(m);u=!1,M||(u=!0,o.focus({preventScroll:!0}),u=!1)}}}function C(i){if(u)return;const o=b();o!==null&&(i.relatedTarget!==null&&o.contains(i.relatedTarget)?a("last"):a("first"))}function K(i){u||(i.relatedTarget!==null&&i.relatedTarget===n.value?a("last"):a("first"))}return{focusableStartRef:n,focusableEndRef:r,focusableStyle:"position: absolute; height: 0; width: 0;",handleStartFocus:C,handleEndFocus:K}},render(){const{default:e}=this.$slots;if(e===void 0)return null;if(this.disabled)return e();const{active:t,focusableStyle:n}=this;return y(q,null,[y("div",{"aria-hidden":"true",tabindex:t?"0":"-1",ref:"focusableStartRef",style:n,onFocus:this.handleStartFocus}),e(),y("div",{"aria-hidden":"true",style:n,ref:"focusableEndRef",tabindex:t?"0":"-1",onFocus:this.handleEndFocus})])}});export{se as F,ee as a,ie as c,ne as d,Y as g,te as m,re as p,W as r,oe as z};
