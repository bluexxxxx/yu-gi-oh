import{_ as G,W as w,r as V,e as H,F as y,G as x,H as a,I as l,J as s,K as b,bc as h,Z as p,bb as J,$ as K,X as U,M as L,N as O,O as c,a0 as C,a1 as P}from"./index.23b0ca4b.js";import{_ as T}from"./Button.9d89bb21.js";import{_ as W}from"./Modal.4aeb7a76.js";import{_ as X}from"./Space.b3dc3fef.js";import{_ as Z}from"./Pagination.a76b6872.js";import{_ as j}from"./Upload.efa274a8.js";import{a as q,_ as Q}from"./FormItem.3b2bb2df.js";import{_ as R}from"./Input.296a4134.js";import{_ as Y,a as ee}from"./Table.1da3a8a5.js";import"./upperFirst.0a0eecce.js";import"./toString.0179cbee.js";import"./use-rtl.c1e91907.js";import"./FadeInExpandTransition.76abbc7b.js";import"./Scrollbar.0bb5a8ce.js";import"./delegate.d660cb22.js";import"./Card.2b7126b3.js";import"./Tag.528c576f.js";import"./Popover.7437eb70.js";import"./keep.76d496a2.js";import"./Add.d3cf3b2b.js";import"./utils.3f54be48.js";import"./Tooltip.00a317b5.js";const S=m=>(L("data-v-532aede0"),m=m(),O(),m),te=S(()=>a("h1",null,"\u5C08\u6B04\u7BA1\u7406",-1)),oe={class:"container"},le={class:"decksbox"},ne=c(" \u65B0\u589E\u5C08\u6B04 "),ae=c("\u9EDE\u64CA\u4E0A\u50B3"),se=c(" \u78BA\u8A8D "),ie=S(()=>a("thead",null,[a("tr",null,[a("th",null,"\u5716\u7247"),a("th",null,"\u540D\u7A31"),a("th",null,"\u63CF\u8FF0"),a("th",null,"\u7DE8\u8F2F"),a("th",null,"\u522A\u9664")])],-1)),re=["src"],ue={style:{"white-space":"pre"}},pe=c(" \u7DE8\u8F2F "),de=c(" \u522A\u9664 "),_e={__name:"DecksView",setup(m){const d=w([]),f=V(!1),g=V(1),v=5,r=H(()=>d.slice(g.value*v-v,g.value*v)),t=w({_id:"",name:"",image:[],description:"",playstyle:"",decklogic:"",article:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),k=n=>{const e=r.value.findIndex(i=>i._id===n);f.value=!0,t._id=n,e>-1?(t.name=r.value[e].name,t.description=r.value[e].description,t.playstyle=r.value[e].playstyle,t.decklogic=r.value[e].decklogic,t.article=r.value[e].article):(t.name="",t.description="",t.article="",t.playstyle="",t.decklogic=""),t.image=[],t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},D=async()=>{t.submitting=!0;const n=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||(e==="image"?t.image.length>0&&n.append(e,t[e][0].file):n.append(e,t[e]));try{if(t._id.length===0){const{data:e}=await h.post("/decks",n);d.push(e.result),p.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await h.patch("/decks/"+t._id,n);d[t.idx]=e.result,p.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){p.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},I=async n=>{const e=r.value.findIndex(i=>i._id===n);try{await h.delete("/decks/"+n),p.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"}),r.value.splice(e,1)}catch(i){p.fire({icon:"error",title:"\u5931\u6557",text:i.isAxiosError?i.response.data.message:i.message})}};return(async()=>{try{const{data:n}=await h.get("/decks/all");d.push(...n.result)}catch(n){console.log(n),p.fire({icon:"error",title:"\u5931\u6557",text:n.isAxiosError?n.response.data.message:n.message})}})(),(n,e)=>{const i=T,N=j,u=q,_=R,$=Q,z=W,A=Y,E=ee,F=X,M=Z;return y(),x(b,null,[te,a("div",oe,[a("div",le,[l(i,{type:"primary",onClick:e[0]||(e[0]=o=>k(""))},{default:s(()=>[ne]),_:1}),l(z,{show:f.value,"onUpdate:show":e[9]||(e[9]=o=>f.value=o),preset:"dialog",title:"\u65B0\u589E\u5361\u7247"},{default:s(()=>[l($,{modelValue:t.valid,"onUpdate:modelValue":e[8]||(e[8]=o=>t.valid=o),onSubmit:J(D,["prevent"])},{default:s(()=>[l(u,{label:"\u5716\u7247"},{default:s(()=>[l(N,{"file-list":t.image,"onUpdate:file-list":e[1]||(e[1]=o=>t.image=o),"list-type":"image-card"},{default:s(()=>[l(i,null,{default:s(()=>[ae]),_:1})]),_:1},8,["file-list"])]),_:1}),l(u,{label:"\u5C08\u6B04\u540D\u7A31"},{default:s(()=>[l(_,{value:t.name,"onUpdate:value":e[2]||(e[2]=o=>t.name=o),placeholder:"\u8ACB\u8F38\u5165\u5C08\u6B04\u540D\u7A31"},null,8,["value"])]),_:1}),l(u,{label:"\u89C0\u5FF5\u89E3\u6790"},{default:s(()=>[l(_,{type:"textarea",autosize:"",value:t.description,"onUpdate:value":e[3]||(e[3]=o=>t.description=o),placeholder:"\u8ACB\u8F38\u5165\u89C0\u5FF5\u89E3\u6790"},null,8,["value"])]),_:1}),l(u,{label:"\u904A\u73A9\u98A8\u683C"},{default:s(()=>[l(_,{type:"textarea",autosize:"",value:t.playstyle,"onUpdate:value":e[4]||(e[4]=o=>t.playstyle=o),placeholder:"\u8ACB\u8F38\u5165\u904A\u73A9\u98A8\u683C"},null,8,["value"])]),_:1}),l(u,{label:"\u7D44\u724C\u908F\u8F2F"},{default:s(()=>[l(_,{type:"textarea",autosize:"",value:t.decklogic,"onUpdate:value":e[5]||(e[5]=o=>t.decklogic=o),placeholder:"\u8ACB\u8F38\u5165\u7D44\u724C\u908F\u8F2F"},null,8,["value"])]),_:1}),l(u,{label:"\u6587\u7AE0\u4F86\u6E90"},{default:s(()=>[l(_,{value:t.article,"onUpdate:value":e[6]||(e[6]=o=>t.article=o),placeholder:"\u8ACB\u8F38\u5165\u6587\u7AE0\u7DB2\u5740"},null,8,["value"])]),_:1}),l(i,{type:"primary","attr-type":"submit",onClick:e[7]||(e[7]=o=>f.value=!1)},{default:s(()=>[se]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["show"]),l(A),a("div",null,[l(F,{vertical:""},{default:s(()=>[l(E,{striped:""},{default:s(()=>[ie,a("tbody",null,[(y(!0),x(b,null,K(U(r),o=>(y(),x(b,null,[U(r).length>0?(y(),x("tr",{key:o._id},[a("td",null,[a("img",{src:o.image},null,8,re)]),a("td",null,C(o.name),1),a("td",ue,C(o.description),1),a("td",null,[l(i,{type:"info",onClick:B=>k(o._id)},{default:s(()=>[pe]),_:2},1032,["onClick"])]),a("td",null,[l(i,{type:"error",onClick:B=>I(o._id)},{default:s(()=>[de]),_:2},1032,["onClick"])])])):P("",!0)],64))),256))])]),_:1})]),_:1})]),l(M,{page:g.value,"onUpdate:page":e[10]||(e[10]=o=>g.value=o),"page-count":Math.ceil(d.length/v)},null,8,["page","page-count"])])])],64)}}},Me=G(_e,[["__scopeId","data-v-532aede0"]]);export{Me as default};
