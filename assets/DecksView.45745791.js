import{_ as J,W as D,r as $,e as K,F as d,G as _,H as s,I as l,J as a,K as x,bc as b,Z as g,a0 as V,bb as L,$ as O,X as I,M as P,N as T,O as p,a1 as v}from"./index.9429d793.js";import{_ as W}from"./Button.f90098ea.js";import{_ as X}from"./Modal.fd38c36e.js";import{_ as Z}from"./Space.da7674a7.js";import{_ as j}from"./Pagination.cf77dda8.js";import{_ as q}from"./Upload.968e0eb6.js";import{a as Q,_ as R}from"./FormItem.518af254.js";import{_ as Y}from"./Input.096f10d8.js";import{_ as ee,a as te}from"./Table.9e5b0d6b.js";import"./upperFirst.67d2e644.js";import"./toString.5292bcf0.js";import"./use-rtl.421ac76c.js";import"./FadeInExpandTransition.8c3b1785.js";import"./Scrollbar.df3f7294.js";import"./delegate.d660cb22.js";import"./Card.2debb890.js";import"./Tag.20d3c9a4.js";import"./Popover.2f19455d.js";import"./keep.76d496a2.js";import"./Add.bf9e59eb.js";import"./utils.3f54be48.js";import"./Tooltip.d3c2e504.js";const N=y=>(P("data-v-2b271af8"),y=y(),T(),y),oe=N(()=>s("h1",null,"\u5C08\u6B04\u7BA1\u7406",-1)),le={class:"container"},ne={class:"decksbox"},ae=p(" \u65B0\u589E\u5C08\u6B04 "),se=p("\u9EDE\u64CA\u4E0A\u50B3"),ie=p(" \u78BA\u8A8D "),re=N(()=>s("thead",null,[s("tr",null,[s("th",null,"\u5716\u7247"),s("th",null,"\u540D\u7A31"),s("th",null,"\u63CF\u8FF0"),s("th",null,"\u7DE8\u8F2F"),s("th",null,"\u522A\u9664")])],-1)),ue=["src"],de={style:{"white-space":"pre"}},_e={key:0},pe=p(" \u7DE8\u8F2F "),ce={key:1},me=p(" \u7DE8\u8F2F "),ge={key:2},fe=p(" \u522A\u9664 "),ve={key:3},ye=p(" \u522A\u9664 "),he={__name:"DecksView",setup(y){const i=D([]),h=$(!1),u=$(1),c=5,U=K(()=>i.slice(u.value*c-c,u.value*c)),t=D({_id:"",name:"",image:[],description:"",playstyle:"",decklogic:"",article:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),w=(n,e)=>{h.value=!0,t._id=n,e>-1?(t.name=i[e].name,t.description=i[e].description,t.playstyle=i[e].playstyle,t.decklogic=i[e].decklogic,t.article=i[e].article):(t.name="",t.description="",t.article="",t.playstyle="",t.decklogic=""),t.image=[],t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},z=async()=>{t.submitting=!0;const n=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||(e==="image"?t.image.length>0&&n.append(e,t[e][0].file):n.append(e,t[e]));try{if(t._id.length===0){const{data:e}=await b.post("/decks",n);i.push(e.result),g.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await b.patch("/decks/"+t._id,n);i[t.idx]=e.result,g.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){g.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},S=async(n,e)=>{try{await b.delete("/decks/"+n),g.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"}),i.splice(e,1)}catch(r){g.fire({icon:"error",title:"\u5931\u6557",text:r.isAxiosError?r.response.data.message:r.message})}};return(async()=>{try{const{data:n}=await b.get("/decks/all");i.push(...n.result)}catch(n){console.log(n),g.fire({icon:"error",title:"\u5931\u6557",text:n.isAxiosError?n.response.data.message:n.message})}})(),(n,e)=>{const r=W,A=q,m=Q,f=Y,E=R,F=X,M=ee,B=te,G=Z,H=j;return d(),_(x,null,[oe,s("div",le,[s("div",ne,[l(r,{type:"primary",onClick:e[0]||(e[0]=o=>w("",-1))},{default:a(()=>[ae]),_:1}),l(F,{show:h.value,"onUpdate:show":e[9]||(e[9]=o=>h.value=o),preset:"dialog"},{default:a(()=>[s("h2",null,V(t._id.length>0?"\u7DE8\u8F2F\u5C08\u6B04":"\u65B0\u589E\u5C08\u6B04"),1),l(E,{modelValue:t.valid,"onUpdate:modelValue":e[8]||(e[8]=o=>t.valid=o),onSubmit:L(z,["prevent"])},{default:a(()=>[l(m,{label:"\u5716\u7247"},{default:a(()=>[l(A,{"file-list":t.image,"onUpdate:file-list":e[1]||(e[1]=o=>t.image=o),"list-type":"image-card"},{default:a(()=>[l(r,null,{default:a(()=>[se]),_:1})]),_:1},8,["file-list"])]),_:1}),l(m,{label:"\u5C08\u6B04\u540D\u7A31"},{default:a(()=>[l(f,{value:t.name,"onUpdate:value":e[2]||(e[2]=o=>t.name=o),placeholder:"\u8ACB\u8F38\u5165\u5C08\u6B04\u540D\u7A31"},null,8,["value"])]),_:1}),l(m,{label:"\u89C0\u5FF5\u89E3\u6790"},{default:a(()=>[l(f,{type:"textarea",autosize:"",value:t.description,"onUpdate:value":e[3]||(e[3]=o=>t.description=o),placeholder:"\u8ACB\u8F38\u5165\u89C0\u5FF5\u89E3\u6790"},null,8,["value"])]),_:1}),l(m,{label:"\u904A\u73A9\u98A8\u683C"},{default:a(()=>[l(f,{type:"textarea",autosize:"",value:t.playstyle,"onUpdate:value":e[4]||(e[4]=o=>t.playstyle=o),placeholder:"\u8ACB\u8F38\u5165\u904A\u73A9\u98A8\u683C"},null,8,["value"])]),_:1}),l(m,{label:"\u7D44\u724C\u908F\u8F2F"},{default:a(()=>[l(f,{type:"textarea",autosize:"",value:t.decklogic,"onUpdate:value":e[5]||(e[5]=o=>t.decklogic=o),placeholder:"\u8ACB\u8F38\u5165\u7D44\u724C\u908F\u8F2F"},null,8,["value"])]),_:1}),l(m,{label:"\u6587\u7AE0\u4F86\u6E90"},{default:a(()=>[l(f,{value:t.article,"onUpdate:value":e[6]||(e[6]=o=>t.article=o),placeholder:"\u8ACB\u8F38\u5165\u6587\u7AE0\u7DB2\u5740"},null,8,["value"])]),_:1}),l(r,{type:"primary","attr-type":"submit",onClick:e[7]||(e[7]=o=>h.value=!1)},{default:a(()=>[ie]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["show"]),l(M),s("div",null,[l(G,{vertical:""},{default:a(()=>[l(B,{striped:""},{default:a(()=>[re,s("tbody",null,[(d(!0),_(x,null,O(I(U),(o,k)=>(d(),_(x,null,[I(U).length>0?(d(),_("tr",{key:o._id},[s("td",null,[s("img",{src:o.image},null,8,ue)]),s("td",null,V(o.name),1),s("td",de,V(o.description),1),u.value===1?(d(),_("td",_e,[l(r,{type:"info",onClick:C=>w(o._id,k),loading:n.loading},{default:a(()=>[pe]),_:2},1032,["onClick","loading"])])):v("",!0),u.value>1?(d(),_("td",ce,[l(r,{type:"info",onClick:C=>w(o._id,k+(u.value-1)*c),loading:n.loading},{default:a(()=>[me]),_:2},1032,["onClick","loading"])])):v("",!0),u.value===1?(d(),_("td",ge,[l(r,{type:"error",onClick:C=>S(o._id,k),loading:n.loading},{default:a(()=>[fe]),_:2},1032,["onClick","loading"])])):v("",!0),u.value>1?(d(),_("td",ve,[l(r,{type:"error",onClick:C=>S(o._id,k+(u.value-1)*c),loading:n.loading},{default:a(()=>[ye]),_:2},1032,["onClick","loading"])])):v("",!0)])):v("",!0)],64))),256))])]),_:1})]),_:1})]),l(H,{page:u.value,"onUpdate:page":e[10]||(e[10]=o=>u.value=o),"page-count":Math.ceil(i.length/c)},null,8,["page","page-count"])])])],64)}}},Oe=J(he,[["__scopeId","data-v-2b271af8"]]);export{Oe as default};
