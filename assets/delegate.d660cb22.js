function K(r=8){return Math.random().toString(16).slice(2,2+r)}function Q(r,s){const u=[];if(!s){for(let o=0;o<r;++o)u.push(o);return u}for(let o=0;o<r;++o)u.push(s(o));return u}const $={mousemoveoutside:new WeakMap,clickoutside:new WeakMap};function q(r,s,u){if(r==="mousemoveoutside"){const o=a=>{s.contains(a.target)||u(a)};return{mousemove:o,touchstart:o}}else if(r==="clickoutside"){let o=!1;const a=b=>{o=!s.contains(b.target)},c=b=>{!o||s.contains(b.target)||u(b)};return{mousedown:a,mouseup:c,touchstart:a,touchend:c}}return console.error(`[evtd/create-trap-handler]: name \`${r}\` is invalid. This could be a bug of evtd.`),{}}function D(r,s,u){const o=$[r];let a=o.get(s);a===void 0&&o.set(s,a=new WeakMap);let c=a.get(u);return c===void 0&&a.set(u,c=q(r,s,u)),c}function A(r,s,u,o){if(r==="mousemoveoutside"||r==="clickoutside"){const a=D(r,s,u);return Object.keys(a).forEach(c=>{G(c,document,a[c],o)}),!0}return!1}function B(r,s,u,o){if(r==="mousemoveoutside"||r==="clickoutside"){const a=D(r,s,u);return Object.keys(a).forEach(c=>{J(c,document,a[c],o)}),!0}return!1}function F(){if(typeof window>"u")return{on:()=>{},off:()=>{}};const r=new WeakMap,s=new WeakMap;function u(){r.set(this,!0)}function o(){r.set(this,!0),s.set(this,!0)}function a(n,e,t){const i=n[e];return n[e]=function(){return t.apply(n,arguments),i.apply(n,arguments)},n}function c(n,e){n[e]=Event.prototype[e]}const b=new WeakMap,P=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function I(){var n;return(n=b.get(this))!==null&&n!==void 0?n:null}function W(n,e){P!==void 0&&Object.defineProperty(n,"currentTarget",{configurable:!0,enumerable:!0,get:e!=null?e:P.get})}const T={bubble:{},capture:{}},H={};function L(){const n=function(e){const{type:t,eventPhase:i,target:d,bubbles:p}=e;if(i===2)return;const w=i===1?"capture":"bubble";let f=d;const l=[];for(;f===null&&(f=window),l.push(f),f!==window;)f=f.parentNode||null;const h=T.capture[t],v=T.bubble[t];if(a(e,"stopPropagation",u),a(e,"stopImmediatePropagation",o),W(e,I),w==="capture"){if(h===void 0)return;for(let g=l.length-1;g>=0&&!r.has(e);--g){const m=l[g],k=h.get(m);if(k!==void 0){b.set(e,m);for(const E of k){if(s.has(e))break;E(e)}}if(g===0&&!p&&v!==void 0){const E=v.get(m);if(E!==void 0)for(const _ of E){if(s.has(e))break;_(e)}}}}else if(w==="bubble"){if(v===void 0)return;for(let g=0;g<l.length&&!r.has(e);++g){const m=l[g],k=v.get(m);if(k!==void 0){b.set(e,m);for(const E of k){if(s.has(e))break;E(e)}}}}c(e,"stopPropagation"),c(e,"stopImmediatePropagation"),W(e)};return n.displayName="evtdUnifiedHandler",n}function U(){const n=function(e){const{type:t,eventPhase:i}=e;if(i!==2)return;const d=H[t];d!==void 0&&d.forEach(p=>p(e))};return n.displayName="evtdUnifiedWindowEventHandler",n}const M=L(),O=U();function j(n,e){const t=T[n];return t[e]===void 0&&(t[e]=new Map,window.addEventListener(e,M,n==="capture")),t[e]}function z(n){return H[n]===void 0&&(H[n]=new Set,window.addEventListener(n,O)),H[n]}function S(n,e){let t=n.get(e);return t===void 0&&n.set(e,t=new Set),t}function C(n,e,t,i){const d=T[e][t];if(d!==void 0){const p=d.get(n);if(p!==void 0&&p.has(i))return!0}return!1}function y(n,e){const t=H[n];return!!(t!==void 0&&t.has(e))}function N(n,e,t,i){let d;if(typeof i=="object"&&i.once===!0?d=h=>{x(n,e,d,i),t(h)}:d=t,A(n,e,d,i))return;const w=i===!0||typeof i=="object"&&i.capture===!0?"capture":"bubble",f=j(w,n),l=S(f,e);if(l.has(d)||l.add(d),e===window){const h=z(n);h.has(d)||h.add(d)}}function x(n,e,t,i){if(B(n,e,t,i))return;const p=i===!0||typeof i=="object"&&i.capture===!0,w=p?"capture":"bubble",f=j(w,n),l=S(f,e);if(e===window&&!C(e,p?"bubble":"capture",n,t)&&y(n,t)){const v=H[n];v.delete(t),v.size===0&&(window.removeEventListener(n,O),H[n]=void 0)}l.has(t)&&l.delete(t),l.size===0&&f.delete(e),f.size===0&&(window.removeEventListener(n,M,w==="capture"),T[w][n]=void 0)}return{on:N,off:x}}const{on:G,off:J}=F();export{G as a,K as c,Q as i,J as o};
